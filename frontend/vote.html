<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Vote</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
    button { margin: 10px 5px; padding: 10px 15px; cursor: pointer; }
    .main-btn { background: #007bff; color: white; border: none; border-radius: 5px; }
    .secondary-btn { background: #6c757d; color: white; border: none; border-radius: 5px; }
    .copy-btn { background: #28a745; color: white; border: none; border-radius: 5px; }
    .nav-buttons { margin-bottom: 20px; }
  </style>
</head>
<body>
  <div class="nav-buttons">
    <button class="secondary-btn" onclick="window.location.href='index.html'">üè† Accueil</button>
    <button class="copy-btn" onclick="copyLink()">üìã Copier le lien</button>
    <button class="secondary-btn" onclick="viewResults()">üìä Voir les r√©sultats</button>
  </div>
  
  <h1 id="question"></h1>
  <div id="options"></div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const id = urlParams.get('id');

function copyLink() {
  const currentUrl = window.location.href;
  navigator.clipboard.writeText(currentUrl).then(() => {
    alert('Lien copi√© dans le presse-papiers !');
  });
}

function viewResults() {
  window.location.href = `results.html?id=${id}`;
}

fetch(`http://localhost:4000/api/polls/${id}`)
  .then(res => res.json())
  .then(poll => {
    document.getElementById('question').textContent = poll.question;
    poll.options.forEach((opt, idx) => {
      const btn = document.createElement('button');
      btn.textContent = opt;
      btn.className = 'main-btn';
      btn.onclick = async () => {
        await fetch(`http://localhost:4000/api/polls/${id}/vote`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ optionIndex: idx })
        });
        window.location.href = `results.html?id=${id}`;
      };
      document.getElementById('options').appendChild(btn);
    });
  });
</script>
</body>
</html>